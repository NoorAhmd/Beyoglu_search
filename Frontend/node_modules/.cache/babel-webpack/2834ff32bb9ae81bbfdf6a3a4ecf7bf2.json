{"ast":null,"code":"/**\n * @module ol/interaction/MouseWheelZoom\n */\nimport ViewHint from '../ViewHint.js';\nimport { always } from '../events/condition.js';\nimport { easeOut } from '../easing.js';\nimport EventType from '../events/EventType.js';\nimport { DEVICE_PIXEL_RATIO, FIREFOX, SAFARI } from '../has.js';\nimport Interaction, { zoomByDelta } from '../interaction/Interaction.js';\nimport { clamp } from '../math.js';\n/**\n * Maximum mouse wheel delta.\n * @type {number}\n */\n\nvar MAX_DELTA = 1;\n/**\n * @enum {string}\n */\n\nexport var Mode = {\n  TRACKPAD: 'trackpad',\n  WHEEL: 'wheel'\n};\n/**\n * @typedef {Object} Options\n * @property {module:ol/events/condition~Condition} [condition] A function that\n * takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a\n * boolean to indicate whether that event should be handled. Default is\n * {@link module:ol/events/condition~always}.\n * @property {number} [duration=250] Animation duration in milliseconds.\n * @property {number} [timeout=80] Mouse wheel timeout duration in milliseconds.\n * @property {boolean} [constrainResolution=false] When using a trackpad or\n * magic mouse, zoom to the closest integer zoom level after the scroll gesture\n * ends.\n * @property {boolean} [useAnchor=true] Enable zooming using the mouse's\n * location as the anchor. When set to `false`, zooming in and out will zoom to\n * the center of the screen instead of zooming on the mouse's location.\n */\n\n/**\n * @classdesc\n * Allows the user to zoom the map by scrolling the mouse wheel.\n * @api\n */\n\nvar MouseWheelZoom = function (Interaction) {\n  function MouseWheelZoom(opt_options) {\n    Interaction.call(this, {\n      handleEvent: handleEvent\n    });\n    var options = opt_options || {};\n    /**\n     * @private\n     * @type {number}\n     */\n\n    this.delta_ = 0;\n    /**\n     * @private\n     * @type {number}\n     */\n\n    this.duration_ = options.duration !== undefined ? options.duration : 250;\n    /**\n     * @private\n     * @type {number}\n     */\n\n    this.timeout_ = options.timeout !== undefined ? options.timeout : 80;\n    /**\n     * @private\n     * @type {boolean}\n     */\n\n    this.useAnchor_ = options.useAnchor !== undefined ? options.useAnchor : true;\n    /**\n     * @private\n     * @type {boolean}\n     */\n\n    this.constrainResolution_ = options.constrainResolution || false;\n    /**\n     * @private\n     * @type {module:ol/events/condition~Condition}\n     */\n\n    this.condition_ = options.condition ? options.condition : always;\n    /**\n     * @private\n     * @type {?module:ol/coordinate~Coordinate}\n     */\n\n    this.lastAnchor_ = null;\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n\n    this.startTime_ = undefined;\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n\n    this.timeoutId_ = undefined;\n    /**\n     * @private\n     * @type {module:ol/interaction/MouseWheelZoom~Mode|undefined}\n     */\n\n    this.mode_ = undefined;\n    /**\n     * Trackpad events separated by this delay will be considered separate\n     * interactions.\n     * @type {number}\n     */\n\n    this.trackpadEventGap_ = 400;\n    /**\n     * @type {number|undefined}\n     */\n\n    this.trackpadTimeoutId_ = undefined;\n    /**\n     * The number of delta values per zoom level\n     * @private\n     * @type {number}\n     */\n\n    this.trackpadDeltaPerZoom_ = 300;\n    /**\n     * The zoom factor by which scroll zooming is allowed to exceed the limits.\n     * @private\n     * @type {number}\n     */\n\n    this.trackpadZoomBuffer_ = 1.5;\n  }\n\n  if (Interaction) MouseWheelZoom.__proto__ = Interaction;\n  MouseWheelZoom.prototype = Object.create(Interaction && Interaction.prototype);\n  MouseWheelZoom.prototype.constructor = MouseWheelZoom;\n  /**\n   * @private\n   */\n\n  MouseWheelZoom.prototype.decrementInteractingHint_ = function decrementInteractingHint_() {\n    this.trackpadTimeoutId_ = undefined;\n    var view = this.getMap().getView();\n    view.setHint(ViewHint.INTERACTING, -1);\n  };\n  /**\n   * @private\n   * @param {module:ol/PluggableMap} map Map.\n   */\n\n\n  MouseWheelZoom.prototype.handleWheelZoom_ = function handleWheelZoom_(map) {\n    var view = map.getView();\n\n    if (view.getAnimating()) {\n      view.cancelAnimations();\n    }\n\n    var maxDelta = MAX_DELTA;\n    var delta = clamp(this.delta_, -maxDelta, maxDelta);\n    zoomByDelta(view, -delta, this.lastAnchor_, this.duration_);\n    this.mode_ = undefined;\n    this.delta_ = 0;\n    this.lastAnchor_ = null;\n    this.startTime_ = undefined;\n    this.timeoutId_ = undefined;\n  };\n  /**\n   * Enable or disable using the mouse's location as an anchor when zooming\n   * @param {boolean} useAnchor true to zoom to the mouse's location, false\n   * to zoom to the center of the map\n   * @api\n   */\n\n\n  MouseWheelZoom.prototype.setMouseAnchor = function setMouseAnchor(useAnchor) {\n    this.useAnchor_ = useAnchor;\n\n    if (!useAnchor) {\n      this.lastAnchor_ = null;\n    }\n  };\n\n  return MouseWheelZoom;\n}(Interaction);\n/**\n * Handles the {@link module:ol/MapBrowserEvent map browser event} (if it was a\n * mousewheel-event) and eventually zooms the map.\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Map browser event.\n * @return {boolean} Allow event propagation.\n * @this {module:ol/interaction/MouseWheelZoom}\n */\n\n\nfunction handleEvent(mapBrowserEvent) {\n  if (!this.condition_(mapBrowserEvent)) {\n    return true;\n  }\n\n  var type = mapBrowserEvent.type;\n\n  if (type !== EventType.WHEEL && type !== EventType.MOUSEWHEEL) {\n    return true;\n  }\n\n  mapBrowserEvent.preventDefault();\n  var map = mapBrowserEvent.map;\n  var wheelEvent =\n  /** @type {WheelEvent} */\n  mapBrowserEvent.originalEvent;\n\n  if (this.useAnchor_) {\n    this.lastAnchor_ = mapBrowserEvent.coordinate;\n  } // Delta normalisation inspired by\n  // https://github.com/mapbox/mapbox-gl-js/blob/001c7b9/js/ui/handler/scroll_zoom.js\n\n\n  var delta;\n\n  if (mapBrowserEvent.type == EventType.WHEEL) {\n    delta = wheelEvent.deltaY;\n\n    if (FIREFOX && wheelEvent.deltaMode === WheelEvent.DOM_DELTA_PIXEL) {\n      delta /= DEVICE_PIXEL_RATIO;\n    }\n\n    if (wheelEvent.deltaMode === WheelEvent.DOM_DELTA_LINE) {\n      delta *= 40;\n    }\n  } else if (mapBrowserEvent.type == EventType.MOUSEWHEEL) {\n    delta = -wheelEvent.wheelDeltaY;\n\n    if (SAFARI) {\n      delta /= 3;\n    }\n  }\n\n  if (delta === 0) {\n    return false;\n  }\n\n  var now = Date.now();\n\n  if (this.startTime_ === undefined) {\n    this.startTime_ = now;\n  }\n\n  if (!this.mode_ || now - this.startTime_ > this.trackpadEventGap_) {\n    this.mode_ = Math.abs(delta) < 4 ? Mode.TRACKPAD : Mode.WHEEL;\n  }\n\n  if (this.mode_ === Mode.TRACKPAD) {\n    var view = map.getView();\n\n    if (this.trackpadTimeoutId_) {\n      clearTimeout(this.trackpadTimeoutId_);\n    } else {\n      view.setHint(ViewHint.INTERACTING, 1);\n    }\n\n    this.trackpadTimeoutId_ = setTimeout(this.decrementInteractingHint_.bind(this), this.trackpadEventGap_);\n    var resolution = view.getResolution() * Math.pow(2, delta / this.trackpadDeltaPerZoom_);\n    var minResolution = view.getMinResolution();\n    var maxResolution = view.getMaxResolution();\n    var rebound = 0;\n\n    if (resolution < minResolution) {\n      resolution = Math.max(resolution, minResolution / this.trackpadZoomBuffer_);\n      rebound = 1;\n    } else if (resolution > maxResolution) {\n      resolution = Math.min(resolution, maxResolution * this.trackpadZoomBuffer_);\n      rebound = -1;\n    }\n\n    if (this.lastAnchor_) {\n      var center = view.calculateCenterZoom(resolution, this.lastAnchor_);\n      view.setCenter(view.constrainCenter(center));\n    }\n\n    view.setResolution(resolution);\n\n    if (rebound === 0 && this.constrainResolution_) {\n      view.animate({\n        resolution: view.constrainResolution(resolution, delta > 0 ? -1 : 1),\n        easing: easeOut,\n        anchor: this.lastAnchor_,\n        duration: this.duration_\n      });\n    }\n\n    if (rebound > 0) {\n      view.animate({\n        resolution: minResolution,\n        easing: easeOut,\n        anchor: this.lastAnchor_,\n        duration: 500\n      });\n    } else if (rebound < 0) {\n      view.animate({\n        resolution: maxResolution,\n        easing: easeOut,\n        anchor: this.lastAnchor_,\n        duration: 500\n      });\n    }\n\n    this.startTime_ = now;\n    return false;\n  }\n\n  this.delta_ += delta;\n  var timeLeft = Math.max(this.timeout_ - (now - this.startTime_), 0);\n  clearTimeout(this.timeoutId_);\n  this.timeoutId_ = setTimeout(this.handleWheelZoom_.bind(this, map), timeLeft);\n  return false;\n}\n\nexport default MouseWheelZoom; //# sourceMappingURL=MouseWheelZoom.js.map","map":{"version":3,"sources":["/Users/n.ah/Projects/ankamap/node_modules/ol/interaction/mousewheelzoom.js"],"names":["ViewHint","always","easeOut","EventType","DEVICE_PIXEL_RATIO","FIREFOX","SAFARI","Interaction","zoomByDelta","clamp","MAX_DELTA","Mode","TRACKPAD","WHEEL","MouseWheelZoom","opt_options","call","handleEvent","options","delta_","duration_","duration","undefined","timeout_","timeout","useAnchor_","useAnchor","constrainResolution_","constrainResolution","condition_","condition","lastAnchor_","startTime_","timeoutId_","mode_","trackpadEventGap_","trackpadTimeoutId_","trackpadDeltaPerZoom_","trackpadZoomBuffer_","__proto__","prototype","Object","create","constructor","decrementInteractingHint_","view","getMap","getView","setHint","INTERACTING","handleWheelZoom_","map","getAnimating","cancelAnimations","maxDelta","delta","setMouseAnchor","mapBrowserEvent","type","MOUSEWHEEL","preventDefault","wheelEvent","originalEvent","coordinate","deltaY","deltaMode","WheelEvent","DOM_DELTA_PIXEL","DOM_DELTA_LINE","wheelDeltaY","now","Date","Math","abs","clearTimeout","setTimeout","bind","resolution","getResolution","pow","minResolution","getMinResolution","maxResolution","getMaxResolution","rebound","max","min","center","calculateCenterZoom","setCenter","constrainCenter","setResolution","animate","easing","anchor","timeLeft"],"mappings":"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","sourcesContent":["/**\n * @module ol/interaction/MouseWheelZoom\n */\nimport ViewHint from '../ViewHint.js';\nimport {always} from '../events/condition.js';\nimport {easeOut} from '../easing.js';\nimport EventType from '../events/EventType.js';\nimport {DEVICE_PIXEL_RATIO, FIREFOX, SAFARI} from '../has.js';\nimport Interaction, {zoomByDelta} from '../interaction/Interaction.js';\nimport {clamp} from '../math.js';\n\n\n/**\n * Maximum mouse wheel delta.\n * @type {number}\n */\nvar MAX_DELTA = 1;\n\n\n/**\n * @enum {string}\n */\nexport var Mode = {\n  TRACKPAD: 'trackpad',\n  WHEEL: 'wheel'\n};\n\n\n/**\n * @typedef {Object} Options\n * @property {module:ol/events/condition~Condition} [condition] A function that\n * takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a\n * boolean to indicate whether that event should be handled. Default is\n * {@link module:ol/events/condition~always}.\n * @property {number} [duration=250] Animation duration in milliseconds.\n * @property {number} [timeout=80] Mouse wheel timeout duration in milliseconds.\n * @property {boolean} [constrainResolution=false] When using a trackpad or\n * magic mouse, zoom to the closest integer zoom level after the scroll gesture\n * ends.\n * @property {boolean} [useAnchor=true] Enable zooming using the mouse's\n * location as the anchor. When set to `false`, zooming in and out will zoom to\n * the center of the screen instead of zooming on the mouse's location.\n */\n\n\n/**\n * @classdesc\n * Allows the user to zoom the map by scrolling the mouse wheel.\n * @api\n */\nvar MouseWheelZoom = (function (Interaction) {\n  function MouseWheelZoom(opt_options) {\n\n    Interaction.call(this, {\n      handleEvent: handleEvent\n    });\n\n    var options = opt_options || {};\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.delta_ = 0;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.duration_ = options.duration !== undefined ? options.duration : 250;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.timeout_ = options.timeout !== undefined ? options.timeout : 80;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.useAnchor_ = options.useAnchor !== undefined ? options.useAnchor : true;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.constrainResolution_ = options.constrainResolution || false;\n\n    /**\n     * @private\n     * @type {module:ol/events/condition~Condition}\n     */\n    this.condition_ = options.condition ? options.condition : always;\n\n    /**\n     * @private\n     * @type {?module:ol/coordinate~Coordinate}\n     */\n    this.lastAnchor_ = null;\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.startTime_ = undefined;\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.timeoutId_ = undefined;\n\n    /**\n     * @private\n     * @type {module:ol/interaction/MouseWheelZoom~Mode|undefined}\n     */\n    this.mode_ = undefined;\n\n    /**\n     * Trackpad events separated by this delay will be considered separate\n     * interactions.\n     * @type {number}\n     */\n    this.trackpadEventGap_ = 400;\n\n    /**\n     * @type {number|undefined}\n     */\n    this.trackpadTimeoutId_ = undefined;\n\n    /**\n     * The number of delta values per zoom level\n     * @private\n     * @type {number}\n     */\n    this.trackpadDeltaPerZoom_ = 300;\n\n    /**\n     * The zoom factor by which scroll zooming is allowed to exceed the limits.\n     * @private\n     * @type {number}\n     */\n    this.trackpadZoomBuffer_ = 1.5;\n\n  }\n\n  if ( Interaction ) MouseWheelZoom.__proto__ = Interaction;\n  MouseWheelZoom.prototype = Object.create( Interaction && Interaction.prototype );\n  MouseWheelZoom.prototype.constructor = MouseWheelZoom;\n\n  /**\n   * @private\n   */\n  MouseWheelZoom.prototype.decrementInteractingHint_ = function decrementInteractingHint_ () {\n    this.trackpadTimeoutId_ = undefined;\n    var view = this.getMap().getView();\n    view.setHint(ViewHint.INTERACTING, -1);\n  };\n\n  /**\n   * @private\n   * @param {module:ol/PluggableMap} map Map.\n   */\n  MouseWheelZoom.prototype.handleWheelZoom_ = function handleWheelZoom_ (map) {\n    var view = map.getView();\n    if (view.getAnimating()) {\n      view.cancelAnimations();\n    }\n    var maxDelta = MAX_DELTA;\n    var delta = clamp(this.delta_, -maxDelta, maxDelta);\n    zoomByDelta(view, -delta, this.lastAnchor_, this.duration_);\n    this.mode_ = undefined;\n    this.delta_ = 0;\n    this.lastAnchor_ = null;\n    this.startTime_ = undefined;\n    this.timeoutId_ = undefined;\n  };\n\n  /**\n   * Enable or disable using the mouse's location as an anchor when zooming\n   * @param {boolean} useAnchor true to zoom to the mouse's location, false\n   * to zoom to the center of the map\n   * @api\n   */\n  MouseWheelZoom.prototype.setMouseAnchor = function setMouseAnchor (useAnchor) {\n    this.useAnchor_ = useAnchor;\n    if (!useAnchor) {\n      this.lastAnchor_ = null;\n    }\n  };\n\n  return MouseWheelZoom;\n}(Interaction));\n\n\n/**\n * Handles the {@link module:ol/MapBrowserEvent map browser event} (if it was a\n * mousewheel-event) and eventually zooms the map.\n * @param {module:ol/MapBrowserEvent} mapBrowserEvent Map browser event.\n * @return {boolean} Allow event propagation.\n * @this {module:ol/interaction/MouseWheelZoom}\n */\nfunction handleEvent(mapBrowserEvent) {\n  if (!this.condition_(mapBrowserEvent)) {\n    return true;\n  }\n  var type = mapBrowserEvent.type;\n  if (type !== EventType.WHEEL && type !== EventType.MOUSEWHEEL) {\n    return true;\n  }\n\n  mapBrowserEvent.preventDefault();\n\n  var map = mapBrowserEvent.map;\n  var wheelEvent = /** @type {WheelEvent} */ (mapBrowserEvent.originalEvent);\n\n  if (this.useAnchor_) {\n    this.lastAnchor_ = mapBrowserEvent.coordinate;\n  }\n\n  // Delta normalisation inspired by\n  // https://github.com/mapbox/mapbox-gl-js/blob/001c7b9/js/ui/handler/scroll_zoom.js\n  var delta;\n  if (mapBrowserEvent.type == EventType.WHEEL) {\n    delta = wheelEvent.deltaY;\n    if (FIREFOX &&\n        wheelEvent.deltaMode === WheelEvent.DOM_DELTA_PIXEL) {\n      delta /= DEVICE_PIXEL_RATIO;\n    }\n    if (wheelEvent.deltaMode === WheelEvent.DOM_DELTA_LINE) {\n      delta *= 40;\n    }\n  } else if (mapBrowserEvent.type == EventType.MOUSEWHEEL) {\n    delta = -wheelEvent.wheelDeltaY;\n    if (SAFARI) {\n      delta /= 3;\n    }\n  }\n\n  if (delta === 0) {\n    return false;\n  }\n\n  var now = Date.now();\n\n  if (this.startTime_ === undefined) {\n    this.startTime_ = now;\n  }\n\n  if (!this.mode_ || now - this.startTime_ > this.trackpadEventGap_) {\n    this.mode_ = Math.abs(delta) < 4 ?\n      Mode.TRACKPAD :\n      Mode.WHEEL;\n  }\n\n  if (this.mode_ === Mode.TRACKPAD) {\n    var view = map.getView();\n    if (this.trackpadTimeoutId_) {\n      clearTimeout(this.trackpadTimeoutId_);\n    } else {\n      view.setHint(ViewHint.INTERACTING, 1);\n    }\n    this.trackpadTimeoutId_ = setTimeout(this.decrementInteractingHint_.bind(this), this.trackpadEventGap_);\n    var resolution = view.getResolution() * Math.pow(2, delta / this.trackpadDeltaPerZoom_);\n    var minResolution = view.getMinResolution();\n    var maxResolution = view.getMaxResolution();\n    var rebound = 0;\n    if (resolution < minResolution) {\n      resolution = Math.max(resolution, minResolution / this.trackpadZoomBuffer_);\n      rebound = 1;\n    } else if (resolution > maxResolution) {\n      resolution = Math.min(resolution, maxResolution * this.trackpadZoomBuffer_);\n      rebound = -1;\n    }\n    if (this.lastAnchor_) {\n      var center = view.calculateCenterZoom(resolution, this.lastAnchor_);\n      view.setCenter(view.constrainCenter(center));\n    }\n    view.setResolution(resolution);\n\n    if (rebound === 0 && this.constrainResolution_) {\n      view.animate({\n        resolution: view.constrainResolution(resolution, delta > 0 ? -1 : 1),\n        easing: easeOut,\n        anchor: this.lastAnchor_,\n        duration: this.duration_\n      });\n    }\n\n    if (rebound > 0) {\n      view.animate({\n        resolution: minResolution,\n        easing: easeOut,\n        anchor: this.lastAnchor_,\n        duration: 500\n      });\n    } else if (rebound < 0) {\n      view.animate({\n        resolution: maxResolution,\n        easing: easeOut,\n        anchor: this.lastAnchor_,\n        duration: 500\n      });\n    }\n    this.startTime_ = now;\n    return false;\n  }\n\n  this.delta_ += delta;\n\n  var timeLeft = Math.max(this.timeout_ - (now - this.startTime_), 0);\n\n  clearTimeout(this.timeoutId_);\n  this.timeoutId_ = setTimeout(this.handleWheelZoom_.bind(this, map), timeLeft);\n\n  return false;\n}\n\n\nexport default MouseWheelZoom;\n\n//# sourceMappingURL=MouseWheelZoom.js.map"]},"metadata":{},"sourceType":"module"}